# This config depends on the defaults.yml testplan
# Only diverging settings are defined here

prepare_shop:
  matrix: &matrix
    php: '["8.2"]'
    mysql: '["8.0"]'
  git:
    shop_url: https://github.com/joernott/oxideshop_test_metapackage.git
    shop_ref: &git_shop_ref 'b-8.0'
  composer:
    allow_plugins:
      repositories: >
        oxid-esales/oxideshop-unified-namespace-generator:true
        oxid-esales/oxideshop-composer-plugin:true
    configure:
    require:
      install: >
        twig-admin-theme
        apex-theme
        codeception/codeception:^5.0
        codeception/module-asserts:^3.0
        codeception/module-db:^3.0
        codeception/module-filesystem:^3.0
        codeception/module-webdriver:^3.1
        composer/composer:^2.0
        incenteev/composer-parameter-handler:^v2.1.4
        mikey179/vfsstream:~1.6.8
        codeception-modules
        codeception-page-objects
        developer-tools
        oxideshop-ide-helper
        phpspec/prophecy-phpunit:^v2.0.1
        phpunit/php-file-iterator:^3.0.5
        phpunit/phpunit:^9.1.1
        squizlabs/php_codesniffer:^3.5.4
      options: '--no-update'
      update_options: '--with-all-dependencies --no-interaction'

install_shop:
  matrix: *matrix
  git:
    shop_ref: *git_shop_ref

install_module:
  matrix: *matrix

unit_tests:
  matrix: *matrix
  configuration: &phpunit_configuration 'vendor/oxid-esales/oxideshop-ce/phpunit.xml'
  # yamllint disable-line rule:line-length
  additional_options: '--bootstrap vendor/oxid-esales/oxideshop-ce/tests/bootstrap.php vendor/oxid-esales/oxideshop-ce/tests --coverage-clover=/var/www/unit_coverage.xml'
  test: 'vendor/oxid-esales/oxideshop-ce/tests/Unit'

integration_tests:
  matrix: *matrix
  configuration: *phpunit_configuration
  additional_options: '--bootstrap vendor/oxid-esales/oxideshop-ce/tests/bootstrap.php'
  test: 'vendor/oxid-esales/oxideshop-ce/tests/Integration'

codeception_tests:
  matrix: *matrix
  # Running on public runners, this should pose no problem
  max_parallel: &codeception_max_parallel 4
  configuration: &codeception_configuration 'vendor/oxid-esales/oxideshop-ce/tests/codeception.yml'

shop_setup_tests:
  matrix: *matrix
  max_parallel: *codeception_max_parallel
  configuration: *codeception_configuration

sonarcloud:
  skip: true

phpcs_tests:
  git:
    ref: 'refs/heads/b-8.0'
