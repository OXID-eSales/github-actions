# This is a helper which renames fields to their new names
# It is needed before the implementation of the breaking changes
# in v5 of these actions
#

global:
  git:
    # See https://stackoverflow.com/questions/25689829/arithmetic-in-go-templates#72465098
    # for an idea how to decrement the len of the by 4 and
    # https://go.dev/play/p/XTqvu0J9Sw1 for a breakdown of this expression
    # yamllint disable-line rule:line-length
    repository: '{{ with .Data.global.git.repository }}{{ . }}{{ else }}{{ len (slice (printf "%*s" (len .Data.global.git.shop_url) "") 4) |slice .Data.global.git.shop_url 19 }}{{ end -}}'
    ref: '{{ with .Data.global.git.ref }}{{ . }}{{ else }}{{ .Data.global.git.shop_ref }}{{ end -}}'

install:
  matrix:
    php: '{{ if not .Data.install.matrix.php }}{{ .Data.install_shop_with_modules.matrix.php }}{{ end }}'
    mysql: '{{ if not .Data.install.matrix.mysql }}{{ .Data.install_shop_with_modules.matrix.mysql }}{{ end }}'
    testplan: '{{ if not .Data.install.matrix.testplan }}{{ .Data.install_shop_with_modules.matrix.testplan }}{{ end }}'
  max_parallel: '{{ if not .Data.install.max_parallel }}{{ .Data.install_shop_with_modules.max_parallel }}{{ end }}'
  docker_login: '{{ if not .Data.install.docker_login }}{{ .Data.install_shop_with_modules.docker_login }}{{ end }}'
  container:
    name: '{{ if not .Data.install.container.name }}{{ .Data.install_shop_with_modules.container.name }}{{ end }}'
    options: '{{ if not .Data.install.container.options }}{{ .Data.install_shop_with_modules.container.options }}{{ end }}'
    method: '{{ .Data.install_shop_with_modules.container.method}}'
  git:
    sdk_url: '{{ if not .Data.install.git.sdk_url }}{{ .Data.install_shop_with_modules.git.sdk_url }}{{ end }}'
    # yamllint disable-line rule:line-length
    sdk_repository: '{{ with .Data.install_shop_with_modules.git.sdk_repository }}{{ . }}{{ else }}{{ len (slice (printf "%*s" (len .Data.install_shop_with_modules.git.sdk_url) "") 4) |slice .Data.install_shop_with_modules.git.sdk_url 19 }}{{ end -}}'
    sdk_ref: '{{ if not .Data.install.git.sdk_ref }}{{ .Data.install_shop_with_modules.git.sdk_ref }}{{ end }}'
    # shop_url: '{{ if not .Data.install.git.shop_url }}{{ .Data.install_shop_with_modules.git.shop_url }}{{ end }}'
    # shop_ref: '{{ if not .Data.install.git.shop_ref }}{{ .Data.install_shop_with_modules.git.shop_ref }}{{ end }}'
    # yamllint disable-line rule:line-length
    repository: '{{ if not .Data.git.repository }}{{ with .Data.install_shop_with_modules.git.repository }}{{ . }}{{ else }}{{ len (slice (printf "%*s" (len .Data.install_shop_with_modules.git.shop_url) "") 4) |slice .Data.install_shop_with_modules.git.shop_url 19 }}{{ end -}}{{ end -}}'
    ref: '{{ if not .Data.git.ref }}{{ with .Data.install_shop_with_modules.git.ref }}{{ . }}{{ else }}{{ if not .Data.install.git.shop_ref }}{{ .Data.install_shop_with_modules.git.shop_ref }}{{ end }}{{ end -}}{{ end -}}'
    enterprise_url: '{{ if not .Data.install.git.enterprise_url }}{{ .Data.install_shop_with_modules.git.enterprise_url }}{{ end }}'
    # yamllint disable-line rule:line-length
    enterprise_repository: '{{ with .Data.install_shop_with_modules.git.enterprise_repository }}{{ . }}{{ else }}{{ len (slice (printf "%*s" (len .Data.install_shop_with_modules.git.enterprise_url) "") 4) |slice .Data.install_shop_with_modules.git.enterprise_url 19 }}{{ end -}}'
    enterprise_ref: '{{ if not .Data.install.git.enterprise_ref }}{{ .Data.install_shop_with_modules.git.enterprise_ref }}{{ end }}'
    default_ref: '{{ if not .Data.install.git.default_ref }}{{ .Data.install_shop_with_modules.git.default_ref }}{{ end }}'
    safe_ref_name: '{{ if not .Data.install.git.safe_ref_name }}{{ .Data.install_shop_with_modules.git.safe_ref_name }}{{ end }}'
  cache:
    bucket: '{{ if not .Data.install.cache.bucket }}{{ .Data.install_shop_with_modules.cache.bucket }}{{ end }}'
    prefix: '{{ if not .Data.install.cache.prefix }}{{ .Data.install_shop_with_modules.cache.prefix }}{{ end }}'
    prepared_shop: '{{ if not .Data.install.cache.prepared_shop }}{{ .Data.install_shop_with_modules.cache.prepared_shop }}{{ end }}'
    prepared_shop_prefix: '{{ if not .Data.install.cache.prepared_shop_prefix }}{{ .Data.install_shop_with_modules.cache.prepared_shop_prefix }}{{ end }}'
  composer:
    dev_ref: '{{ if not .Data.install.composer.dev_ref }}{{ .Data.install_shop_with_modules.composer.dev_ref }}{{ end }}'
    ref_name: '{{ if not .Data.install.composer.ref_name }}{{ .Data.install_shop_with_modules.composer.ref_name }}{{ end }}'
    file: '{{ if not .Data.install.composer.file }}{{ .Data.install_shop_with_modules.composer.file }}{{ end }}'
    backup: '{{ if not .Data.install.composer.backup }}{{ .Data.install_shop_with_modules.composer.backup }}{{ end }}'
    transform: '{{ if not .Data.install.composer.transform }}{{ .Data.install_shop_with_modules.composer.transform }}{{ end }}'
    update: '{{ if not .Data.install.composer.update }}{{ .Data.install_shop_with_modules.composer.update }}{{ end }}'
    update-options: '{{ if not .Data.install.composer.update_options }}{{ .Data.install_shop_with_modules.composer.update_options }}{{ end }}'
    root_url: '{{ if not .Data.install.composer.root_url }}{{ .Data.install_shop_with_modules.composer.root_url }}{{ end }}'
  custom_ini:
    error_reporting: '{{ if not .Data.install.custom_ini.error_reporting }}{{ .Data.install_shop_with_modules.custom_ini.error_reporting }}{{ end }}'
    xdebug: '{{ if not .Data.install.custom_ini.xdebug }}{{ .Data.install_shop_with_modules.custom_ini.xdebug }}{{ end }}'
  add_services: '{{ if not .Data.install.add_services }}{{ .Data.install_shop_with_modules.add_services }}{{ end }}'
  config:
    idebug: '{{ if not .Data.install.config.idebug }}{{ .Data.install_shop_with_modules.config.idebug }}{{ end }}'
  custom_script: '{{ if not .Data.install.custom_script }}{{ .Data.install_shop_with_modules.custom_script }}{{ end }}'
  custom_script_container: '{{ if not .Data.install.custom_script_container }}{{ .Data.install_shop_with_modules.custom_script_container }}{{ end }}'
  skip_shop_installation: '{{ if not .Data.install.skip_shop_installation }}{{ .Data.install_shop_with_modules.skip_shop_installation }}{{ end }}'
  output:
    files: '{{ if not .Data.install.output.files }}{{ .Data.install_shop_with_modules.output.files }}{{ end }}'
    # The configuration file name is dynamic, the matrix variables will be appended
    artifact_prefix: 'install'
